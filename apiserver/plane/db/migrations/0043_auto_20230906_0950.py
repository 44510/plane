# Generated by Django 4.2.3 on 2023-09-06 09:50

from django.db import migrations, models

def update_issue_dates(apps, schema_editor):
    Issue = apps.get_model("db", "Issue")
    updated_issues = []
    for obj in Issue.objects.filter(start_date__gt=models.F("target_date")):
        start_date = obj.start_date
        obj.start_date = obj.target_date
        obj.target_date = start_date
        updated_issues.append(obj)
    Issue.objects.bulk_update(updated_issues, ["target_date", "start_date"], batch_size=100)


def update_cycle_dates(apps, schema_editor):
    Cycle = apps.get_model("db", "Cycle")
    update_cycles = []
    for obj in Cycle.objects.filter(start_date__gt=models.F("end_date")):
        start_date = obj.start_date
        obj.start_date = obj.end_date
        obj.end_date = start_date
        update_cycles.append(obj)
    Cycle.objects.bulk_update(update_cycles, ["start_date", "end_date"], batch_size=100)

class Migration(migrations.Migration):

    dependencies = [
        ('db', '0042_alter_analyticview_created_by_and_more'),
    ]

    operations = [
        migrations.RunPython(update_issue_dates),
        migrations.RunPython(update_cycle_dates),
    ]
